(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[718],{98579:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return G}});var r=n(47313),i=n(9019),a=n(85554),c=n(56573),s=n(2388);var o=n(69099),d=n(51629),l=n(70501),p=n(66835),u=n(23477),h=n(24076),m=n(67478),j=n(57861),x=n(39821),y=n(20510);const g=async()=>{const e=await fetch("http://api.videosdk.live/v2/rooms",{method:"POST",headers:{authorization:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcGlrZXkiOiI0N2NhY2IzMy1lMDNjLTRiOGUtODBhNy05OTViMTUyMjc2ODgiLCJwZXJtaXNzaW9ucyI6WyJhbGxvd19qb2luIl0sImlhdCI6MTY5OTAyNTQ5MCwiZXhwIjoxNjk5NjMwMjkwfQ.70E0mdo5YXy0aak6V9-VENuU8Hk9b34-pG8FdEevpuk","Content-Type":"application/json"},body:JSON.stringify({})}),{roomId:t}=await e.json();return t};var b=n(19860),v=n(61113),f=n(32802),w=n(51405),Z=n(5390),_=n.n(Z),k=n(53677),P=n(72225),C=n(38361),I=n(6627),S=n(89903),O=n(96454),M=n(4222),T=n(8445),E=n(73428),N=n(93405),D=n(84488),z=n(12401),L=n(46417);var R=()=>(0,L.jsx)(E.Z,{children:(0,L.jsx)(N.Z,{children:(0,L.jsxs)(i.ZP,{container:!0,spacing:z.dv,children:[(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsxs)(i.ZP,{container:!0,alignItems:"center",justifyContent:"space-between",spacing:z.dv,children:[(0,L.jsx)(i.ZP,{item:!0,xs:!0,zeroMinWidth:!0,children:(0,L.jsxs)(i.ZP,{container:!0,spacing:1,children:[(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsx)(D.Z,{variant:"text"})}),(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsx)(D.Z,{variant:"rectangular",height:20})})]})}),(0,L.jsx)(i.ZP,{item:!0,children:(0,L.jsx)(D.Z,{variant:"rectangular",height:50,width:80})})]})}),(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsx)(D.Z,{variant:"rectangular",height:530})})]})})}),F=n(33497),J=n(976);function A(e){let{getMeetingAndToken:t}=e;const[n,i]=(0,r.useState)(null),a=async()=>{await t(n)};return(0,L.jsxs)("div",{children:[(0,L.jsx)("input",{type:"text",placeholder:"Enter Meeting Id",onChange:e=>{i(e.target.value)}}),(0,L.jsx)("button",{onClick:a,children:"Join"})," or ",(0,L.jsx)("button",{onClick:a,children:"Create Meeting"})]})}function B(e){const t=(0,r.useRef)(null),{webcamStream:n,micStream:i,webcamOn:a,micOn:c,isLocal:s,displayName:o}=(0,x.aV)(e.participantId),d=(0,r.useMemo)((()=>{if(a&&n){const e=new MediaStream;return e.addTrack(n.track),e}}),[n,a]);return(0,r.useEffect)((()=>{if(t.current)if(c&&i){const e=new MediaStream;e.addTrack(i.track),t.current.srcObject=e,t.current.play().catch((e=>console.error("videoElem.current.play() failed",e)))}else t.current.srcObject=null}),[i,c]),(0,L.jsxs)("div",{children:[(0,L.jsxs)("p",{children:["Participant: ",o," | Webcam: ",a?"ON":"OFF"," | Mic:"," ",c?"ON":"OFF"]}),(0,L.jsx)("audio",{ref:t,autoPlay:!0,muted:s,children:(0,L.jsx)("track",{kind:"captions"})}),a&&(0,L.jsx)(y.Z,{playsinline:!0,pip:!1,light:!1,controls:!1,muted:!0,playing:!0,url:d,height:"200px",width:"300px",onError:e=>{console.log(e,"participant video error")}})]},e.participantId)}function U(){const{leave:e,toggleMic:t,toggleWebcam:n}=(0,x.p4)();return(0,L.jsxs)("div",{children:[(0,L.jsx)("button",{onClick:()=>e(),children:"Leave"}),(0,L.jsx)("button",{onClick:()=>t(),children:"toggleMic"}),(0,L.jsx)("button",{onClick:()=>n(),children:"toggleWebcam"})]})}function q(e){const[t,n]=(0,r.useState)(null),{join:i}=(0,x.p4)(),{participants:a}=(0,x.p4)({onMeetingJoined:()=>{n("JOINED")},onMeetingLeft:()=>{e.onMeetingLeave()}});return(0,L.jsxs)("div",{className:"container",children:[(0,L.jsxs)("h3",{children:["Meeting Id: ",e.meetingId]}),t&&"JOINED"==t?(0,L.jsxs)("div",{children:[(0,L.jsx)(U,{}),[...a.keys()].map((e=>(0,L.jsx)(B,{participantId:e},e)))]}):t&&"JOINING"==t?(0,L.jsx)("p",{children:"Joining the meeting..."}):(0,L.jsx)("button",{onClick:()=>{n("JOINING"),i()},children:"Join"})]})}_().config.update({accessKeyId:k.Z.aws_access_key_id,secretAccessKey:k.Z.aws_secret_access_key,region:k.Z.aws_region});var $=e=>{let{isLoading:t}=e;const n=(0,b.Z)(),y=(0,a.v9)((e=>e.customization)),{navType:Z}=y,{primary:k}=n.palette.text,E=n.palette.dark.light,N=n.palette.grey[200],D=n.palette.grey[500],B=n.palette.primary[200],U=n.palette.primary.dark,$=n.palette.secondary.main,G=n.palette.secondary.light,[W,V]=(0,r.useState)([]),[X,K]=(0,r.useState)(null),[Y,Q]=(0,r.useState)([]),[H,ee]=(0,r.useState)(""),te=new(_().S3),{logout:ne}=(0,s.D3)(),{getUserId:re,getAuthToken:ie}=(()=>{const{user:e,getIdTokenClaims:t,isAuthenticated:n}=(0,s.D3)();return{getUserId:()=>n?e.sub:null,getAuthToken:async()=>{if(!n)return null;try{return(await t()).__raw}catch(e){return console.error("Error obtaining access token:",e),null}}}})(),[ae,ce]=(0,r.useState)(null),[se,oe]=(0,r.useState)(null);async function de(){var e;if(!await(e="https://checkout.razorpay.com/v1/checkout.js",new Promise((t=>{const n=document.createElement("script");n.src=e,n.onload=()=>{t(!0)},n.onerror=()=>{t(!1)},document.body.appendChild(n)}))))return void alert("Razorpay SDK failed to load. Are you online?");const t=parseFloat(H.split("-")[1])-X;console.log("Balance amount:",t);const n=await c.Z.post("http://localhost:5000/payment/orders",{amount:t});if(!n)return void alert("Server error. Are you online?");const{amount:r,id:i,currency:a}=n.data,s={key:"rzp_test_WUni4vBy2NBp3D",amount:r.toString(),currency:a,name:"Soumya Corp.",description:"Test Transaction",order_id:i,handler:async function(e){const t={orderCreationId:i,razorpayPaymentId:e.razorpay_payment_id,razorpayOrderId:e.razorpay_order_id,razorpaySignature:e.razorpay_signature};(await c.Z.post("http://localhost:5000/payment/success",t)).data.paymentAmount||alert("Payment failed")},prefill:{name:"Soumya Dey",email:"SoumyaDey@example.com",contact:"9999999999"},notes:{address:"Soumya Dey Corporate Office"},theme:{color:"#61dafb"}};new window.Razorpay(s).open()}(0,r.useEffect)((()=>{(async()=>{const e=re(),t=await ie();ce(e),oe(t),console.log(se),console.log(ae)})();const e={"Content-Type":"application/json",Authorization:`Bearer ${se}`,"X-Hasura-Role":"doctor"},t=new P.u({uri:"http://backend.cardiofit.in/v1/graphql",headers:e}),n=new M.A({uri:"ws://backend.cardiofit.in/v1/graphql",options:{reconnect:!0,connectionParams:{headers:e}}}),r=(0,C.V)((e=>{let{query:t}=e;const n=(0,T.p$)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),n,t),i=new I.f({link:r,cache:new S.h}),a=O.Ps`
    subscription MySubscription {
      wallet(where: {uid: {_eq: "${ae}"}}) {
        id
        wallet_balance
      }
    }
  `,c=O.Ps`
    subscription MySubscription {
      device_info(
        where: { attached_uid: { _eq:  "${ae}"}, device_status: { _eq: true } }
        order_by: { device_info_patients_aggregate: {}, last_active: asc }
      ) {
        device_info_patients {
          name
          mobile
          is_active
          attached_device
          duration
          uid
          updated_at
          end_date
          payment
          report
          unread
          attached_report
        }
        added_at
        device_type
      }
    }
  `,s=O.Ps`
    subscription MySubscription {
      products(where: {product_type: {_eq: "service"}}) {
        id
        price
        duration
      }
    }
  `,o=i.subscribe({query:a}).subscribe({next(e){const t=e.data.wallet[0].wallet_balance;K(t)},error(e){console.error("Error:",e)}}),d=i.subscribe({query:c}).subscribe({next(e){const t=e.data.device_info.map((e=>({deviceType:e.device_type,patients:e.device_info_patients})));V(t),console.log(e.data)},error(e){console.error("Error in AnotherSubscription:",e)}}),l=i.subscribe({query:s}).subscribe({next(e){Q(e.data.products),ee(e.data.products[0].duration+"-"+e.data.products[0].price),console.log(ee)},error(e){console.error("Error:",e)}});return()=>{o.unsubscribe(),d.unsubscribe(),l.unsubscribe()}}),[Z,B,U,$,G,k,E,N,t,D,re,ie]);const[le,pe]=(0,r.useState)(null),ue=()=>{pe(null)};return(0,L.jsx)(L.Fragment,{children:t?(0,L.jsx)(R,{}):(0,L.jsx)(F.Z,{children:(0,L.jsxs)(i.ZP,{container:!0,spacing:z.dv,children:[(0,L.jsxs)(i.ZP,{item:!0,xs:12,children:[se&&le?(0,L.jsx)(x.lU,{config:{meetingId:le,micEnabled:!0,webcamEnabled:!0,name:"C.V. Raman"},token:se,children:(0,L.jsx)(x.zQ,{children:()=>(0,L.jsx)(q,{meetingId:le,onMeetingLeave:ue})})}):(0,L.jsx)(A,{getMeetingAndToken:async e=>{const t=null==e?await g():e;pe(t)}}),(0,L.jsxs)(i.ZP,{container:!0,alignItems:"center",justifyContent:"space-between",children:[(0,L.jsx)(i.ZP,{item:!0,children:(0,L.jsxs)(i.ZP,{container:!0,direction:"column",spacing:1,children:[(0,L.jsx)(i.ZP,{item:!0,children:(0,L.jsx)(v.Z,{variant:"subtitle2",children:"Total Growth"})}),(0,L.jsx)(i.ZP,{item:!0,children:(0,L.jsxs)(v.Z,{variant:"h3",children:["$",X?`$${X.toFixed(2)}`:"Loading..."]})})]})}),(0,L.jsx)(i.ZP,{item:!0,children:(0,L.jsx)(J.Z,{children:(0,L.jsx)(o.Z,{onClick:()=>ne({returnTo:window.location.origin}),fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"secondary",children:"Logout"})})})]})]}),(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsx)(d.Z,{component:l.Z,children:(0,L.jsxs)(p.Z,{children:[(0,L.jsx)(u.Z,{children:(0,L.jsxs)(h.Z,{children:[(0,L.jsx)(m.Z,{}),(0,L.jsx)(m.Z,{children:"Patients"}),(0,L.jsx)(m.Z,{children:"Actions"}),(0,L.jsx)(m.Z,{children:"Status"})]})}),(0,L.jsx)(j.Z,{children:W.map(((e,t)=>(0,L.jsxs)(h.Z,{children:[(0,L.jsx)(m.Z,{children:(0,L.jsxs)("ul",{children:[(0,L.jsx)("p",{children:e.deviceType}),e.patients.map((e=>(0,L.jsx)("li",{children:(0,L.jsxs)("p",{children:["Duration: ",e.duration," Days"]})},e.uid)))]})}),(0,L.jsx)(m.Z,{children:(0,L.jsx)("ul",{children:e.patients.map((e=>(0,L.jsxs)("li",{children:[(0,L.jsxs)("p",{children:["Name: ",e.name]}),(0,L.jsxs)("p",{children:["Mobile: ",e.mobile]}),(0,L.jsxs)("p",{children:["Is Active: ",e.is_active?"Yes":"No"]}),(0,L.jsxs)("p",{children:["Payment: ",e.payment?"Paid":"Not Paid"]})]},e.uid)))})}),(0,L.jsx)(m.Z,{children:e.patients.map((e=>{return(0,L.jsx)("li",{children:e.payment?"Paid":(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("p",{children:(0,L.jsx)(f.Z,{id:"standard-select-currency",select:!0,value:H,onChange:e=>ee(e.target.value),children:Y.map(((e,t)=>(0,L.jsx)(w.Z,{value:`${e.duration}-${e.price}`,children:`${e.duration} Days + \u20b9 ${e.price}`},t)))})}),(0,L.jsx)("p",{children:(t=parseFloat(H.split("-")[1]),n=X,t<=n?(0,L.jsx)("button",{children:"Pay"}):(0,L.jsx)("button",{onClick:de,children:"Recharge and Pay"}))})]})},e.uid);var t,n}))}),(0,L.jsx)(m.Z,{children:e.patients.map((e=>(0,L.jsx)("li",{children:"report done"===e.is_active?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("p",{children:(0,L.jsx)(o.Z,{variant:"contained",color:"primary",onClick:()=>function(e){var t={Bucket:"vaidshalareport133928-dev/public",Key:e};te.getObject(t,((t,n)=>{if(t)console.error("Error downloading the file:",t);else{const t=new Blob([n.Body],{type:n.ContentType}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r)}}))}(e.attached_report),children:" Open Report"})}),(0,L.jsx)("p",{children:(0,L.jsx)(o.Z,{variant:"contained",color:"secondary",onClick:()=>(e=>{pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js";const t={Bucket:"vaidshalareport133928-dev/public",Key:e,ResponseContentType:"application/pdf"};te.getObject(t,((e,t)=>{if(e)return void console.error("Error fetching the PDF:",e);const n=new Blob([t.Body],{type:"application/pdf"}),r=URL.createObjectURL(n);pdfjsLib.getDocument(r).promise.then((e=>e.getPage(1))).then((e=>{const t=e.getViewport({scale:1.5}),n=document.createElement("canvas"),i=n.getContext("2d");n.height=t.height,n.width=t.width;const a={canvasContext:i,viewport:t};e.render(a).promise.then((()=>{const e=window.open("","_blank");e.document.body.appendChild(n),e.document.close(),e.print(),URL.revokeObjectURL(r)}))}))}))})(e.attached_report),children:"Print Report"})}),(0,L.jsx)("p",{children:(0,L.jsx)(o.Z,{variant:"contained",color:"primary",onClick:()=>(async(e,t)=>{const n=new(_().S3),r={Bucket:"vaidshalareport133928-dev/public",Key:e};try{const i=await n.getObject(r).promise(),a=nodemailer.createTransport({service:"gmail",auth:{user:"sendmail@cardiofit.in",pass:"kRv9EGeZpFxXbBQacw8M5r"}}),c={from:'"Sender Name" <sendmail@cardiofit.in>',to:t,subject:"Your Requested PDF",text:"Please find attached the requested PDF.",attachments:[{filename:e,content:i.Body,contentType:"application/pdf"}]},s=await a.sendMail(c);console.log("Email sent:",s)}catch(i){console.error("Error sending email:",i)}})(e.attached_report,"appu.apoorva554@gmail.com"),children:"Send PDF to Email"})})]}):e.is_active},e.uid)))})]},t)))})]})})}),(0,L.jsx)(i.ZP,{item:!0,xs:12})]})})})};var G=()=>{const[e,t]=(0,r.useState)(!0);return(0,r.useEffect)((()=>{t(!1)}),[]),(0,L.jsxs)(i.ZP,{container:!0,spacing:z.dv,children:[(0,L.jsx)(i.ZP,{item:!0,xs:12,children:(0,L.jsx)($,{isLoading:e})}),(0,L.jsx)(i.ZP,{container:!0,spacing:z.dv,children:(0,L.jsx)(i.ZP,{item:!0,xs:12,md:8})})]})}},28022:function(){}}]);